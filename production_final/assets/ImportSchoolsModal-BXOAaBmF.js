import{r as x,G as E,j as e}from"./app-ZrEbd4JQ.js";import{X as V}from"./x-NGPg8wIZ.js";import{F}from"./file-text-BE8Bx8Cv.js";import{D as O}from"./download-BMENo1ns.js";import{C as U,U as D}from"./upload-CGvEcmjR.js";/* empty css            */import"./createLucideIcon-eXmKYiaX.js";function q({isOpen:C,onClose:d,onSuccess:p}){const[P,u]=x.useState(!1),[o,g]=x.useState(null),[b,f]=x.useState([]),[w,m]=x.useState({}),[j,c]=x.useState(!1);E();const y=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?u(!0):s.type==="dragleave"&&u(!1)},T=s=>{s.preventDefault(),s.stopPropagation(),u(!1),s.dataTransfer.files&&s.dataTransfer.files[0]&&N(s.dataTransfer.files[0])},N=s=>{if(s.type!=="text/csv"&&!s.name.endsWith(".csv")){m({file:"File harus berformat CSV (.csv)"});return}g(s),m({}),A(s)},A=s=>{const i=new FileReader;i.onload=r=>{const a=r.target.result.split(`
`),l=a[0].split(";"),n=[];for(let h=1;h<Math.min(6,a.length);h++)if(a[h].trim()){const v=a[h].split(";"),k={};l.forEach((R,S)=>{k[R.trim()]=v[S]?v[S].trim():""}),n.push(k)}f(n)},i.readAsText(s)},M=()=>{var r;if(!o){m({file:"Pilih file CSV terlebih dahulu"});return}c(!0),m({}),console.log("🚀 Mulai import sekolah:",o.name),console.log("📁 File size:",o.size),console.log("📄 File type:",o.type);const s=new FormData;s.append("file",o),console.log("📋 FormData entries:");for(let[t,a]of s.entries())console.log("  -",t,":",a);const i=(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content");console.log("🔐 CSRF Token:",i?"Ada":"Tidak ada"),console.log("🌐 Current URL:",window.location.href),console.log("🎯 Target URL:","/schools/import"),fetch("/schools/import",{method:"POST",headers:{Accept:"application/json"},body:s}).then(t=>(console.log("📡 Response status:",t.status),console.log("📡 Response headers:",t.headers),t.redirected?(console.log("🔄 Response redirected to:",t.url),t.text().then(a=>{if(console.log("📄 HTML Response:",a.substring(0,500)),a.includes("success")||a.includes("berhasil"))alert("Import sekolah berhasil! Halaman akan di-refresh."),p(),d(),g(null),f([]);else{const l=a.match(/error.*?>(.*?)</i);l?alert("Error: "+l[1]):(alert("Import selesai. Silakan refresh halaman untuk melihat hasil."),p(),d())}c(!1)})):t.ok?t.json().then(a=>{console.log("✅ Import berhasil:",a),alert("Import sekolah berhasil! Halaman akan di-refresh."),p(),d(),g(null),f([]),c(!1)}):t.text().then(a=>{console.error("❌ Import error:",a);let l="Terjadi kesalahan saat import";try{const n=JSON.parse(a);n.errors?l+=`:
`+Object.values(n.errors).join(`
`):n.message&&(l+=": "+n.message)}catch{l+=": "+a.substring(0,200)}alert(l),m({file:l}),c(!1)}))).catch(t=>{console.error("❌ Network error:",t),alert("Gagal mengirim request: "+t.message),m({file:"Network error: "+t.message}),c(!1)})},I=()=>{const s=["NPSN;Nama Sekolah;Password","12345678;SMA Negeri 1 Jakarta;password123","87654321;SMA Negeri 2 Bandung;password456","11223344;SMA Negeri 3 Surabaya;password789"].join(`
`),i=new Blob([s],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),t=URL.createObjectURL(i);r.setAttribute("href",t),r.setAttribute("download","template_import_sekolah.csv"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)};return C?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Import Sekolah dari File CSV"}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(V,{className:"h-5 w-5 sm:h-6 sm:w-6"})})]}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsx("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-maroon-50 border border-maroon-200 rounded-lg",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-3 sm:space-y-0",children:[e.jsx(F,{className:"h-5 w-5 text-maroon-500 mr-2 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-maroon-900 text-sm sm:text-base",children:"Download Template CSV"}),e.jsx("p",{className:"text-xs sm:text-sm text-maroon-700 mt-1",children:"Gunakan template ini sebagai panduan format yang benar untuk import sekolah"})]}),e.jsxs("button",{onClick:I,className:"w-full sm:w-auto inline-flex items-center justify-center px-3 py-2 border border-maroon-300 rounded-md text-xs sm:text-sm font-medium text-maroon-700 bg-white hover:bg-maroon-50",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Download Template"]})]})}),e.jsx("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(U,{className:"h-5 w-5 text-yellow-500 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-900 text-sm sm:text-base",children:"Format yang Diperlukan"}),e.jsxs("ul",{className:"text-xs sm:text-sm text-yellow-700 mt-2 space-y-1",children:[e.jsx("li",{children:"• File harus berformat CSV dengan delimiter semicolon (;)"}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Kolom wajib:"})," NPSN, Nama Sekolah, Password"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Kolom opsional:"})," ","Alamat, Email, Telepon (bisa dikosongkan)"]}),e.jsx("li",{children:"• NPSN harus unik (8 digit angka)"}),e.jsx("li",{children:"• Password akan di-hash secara otomatis"}),e.jsx("li",{children:"• Email akan dibuat otomatis jika kosong"})]})]})]})}),e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih File CSV"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 sm:p-6 text-center ${P?"border-maroon-500 bg-maroon-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:y,onDragLeave:y,onDragOver:y,onDrop:T,children:[e.jsx(D,{className:"mx-auto h-8 w-8 sm:h-12 sm:w-12 text-gray-400"}),e.jsxs("div",{className:"mt-3 sm:mt-4",children:[e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium text-maroon-600 hover:text-maroon-500",children:"Klik untuk upload"})," ","atau drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"File CSV dengan delimiter semicolon (;)"})]}),e.jsx("input",{type:"file",accept:".csv",name:"csv_file",onChange:s=>N(s.target.files[0]),className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"mt-3 sm:mt-4 inline-flex items-center justify-center px-3 sm:px-4 py-2 border border-transparent text-xs sm:text-sm font-medium rounded-md text-white bg-maroon-600 hover:bg-maroon-700 cursor-pointer",children:"Pilih File"})]}),w.file&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:w.file})]}),o&&e.jsx("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{className:"h-5 w-5 text-green-500 mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-green-900 text-sm sm:text-base",children:["File dipilih: ",o.name]}),e.jsxs("p",{className:"text-xs sm:text-sm text-green-700",children:["Ukuran:"," ",(o.size/1024).toFixed(2)," ","KB"]})]})]})}),b.length>0&&e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Preview Data (5 baris pertama)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:Object.keys(b[0]||{}).map(s=>e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border border-gray-200",children:s},s))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map((s,i)=>e.jsx("tr",{children:Object.values(s).map((r,t)=>e.jsx("td",{className:"px-2 sm:px-3 py-2 text-xs sm:text-sm text-gray-900 border border-gray-200",children:r||"-"},t))},i))})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3",children:[e.jsx("button",{onClick:d,className:"w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Batal"}),e.jsx("button",{onClick:M,disabled:!o||j,className:"w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-maroon-600 hover:bg-maroon-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Mengimport..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Import Sekolah"]})})]})]})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-60",children:e.jsx("div",{className:"bg-white rounded-lg p-4 sm:p-6 shadow-xl mx-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-b-2 border-maroon-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900",children:"Mengimport Sekolah..."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Mohon tunggu sebentar"})]})]})})})]}):null}export{q as default};
