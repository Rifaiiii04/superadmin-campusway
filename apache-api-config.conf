# Apache Configuration for API Integration
# This file should be included in your Apache virtual host configuration

# Enable CORS headers for API routes
<LocationMatch "^/super-admin/api/">
    # CORS Headers
    Header always set Access-Control-Allow-Origin "http://103.23.198.101"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
    Header always set Access-Control-Allow-Credentials "true"
    Header always set Access-Control-Max-Age "3600"
    
    # Handle preflight requests
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
    
    # Set proper content type for JSON responses
    Header always set Content-Type "application/json; charset=utf-8"
    
    # Cache control for API responses
    Header always set Cache-Control "public, max-age=300"
</LocationMatch>

# Specific configuration for public API routes
<LocationMatch "^/super-admin/api/public/">
    # Allow all origins for public API
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
    
    # No credentials needed for public API
    Header always unset Access-Control-Allow-Credentials
</LocationMatch>

# Error handling for API routes
<LocationMatch "^/super-admin/api/">
    # Custom error pages for API
    ErrorDocument 404 "{\"success\":false,\"message\":\"API endpoint not found\",\"error\":\"404\"}"
    ErrorDocument 500 "{\"success\":false,\"message\":\"Internal server error\",\"error\":\"500\"}"
    
    # Disable default error pages
    ErrorDocument 403 "{\"success\":false,\"message\":\"Forbidden\",\"error\":\"403\"}"
</LocationMatch>

# Security headers for API
<LocationMatch "^/super-admin/api/">
    # Remove server signature
    Header always unset Server
    Header always unset X-Powered-By
    
    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set X-XSS-Protection "1; mode=block"
    
    # Rate limiting headers (if mod_evasive is installed)
    # Header always set X-RateLimit-Limit "1000"
    # Header always set X-RateLimit-Remaining "999"
</LocationMatch>

# Logging for API requests
<LocationMatch "^/super-admin/api/">
    # Custom log format for API requests
    LogFormat "%h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\" %D" api_log
    CustomLog logs/api_access.log api_log
</LocationMatch>
