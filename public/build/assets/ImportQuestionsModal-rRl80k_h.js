import{r as x,G as I,j as e}from"./app-Cmg1-cqd.js";import{X as R}from"./x-B-12kS2G.js";import{F as T}from"./file-text-Cocr6uo_.js";import{D as V}from"./download-CTo36Zci.js";import{C as E,U as F}from"./upload-DtlxuHGY.js";/* empty css            */import"./createLucideIcon-CKh2Sp53.js";function K({isOpen:S,onClose:d,onSuccess:p}){const[C,u]=x.useState(!1),[i,g]=x.useState(null),[b,f]=x.useState([]),[w,m]=x.useState({}),[j,c]=x.useState(!1);I();const y=a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?u(!0):a.type==="dragleave"&&u(!1)},A=a=>{a.preventDefault(),a.stopPropagation(),u(!1),a.dataTransfer.files&&a.dataTransfer.files[0]&&v(a.dataTransfer.files[0])},v=a=>{if(a.type!=="text/csv"&&!a.name.endsWith(".csv")){m({file:"File harus berformat CSV (.csv)"});return}g(a),m({}),M(a)},M=a=>{const n=new FileReader;n.onload=r=>{const t=r.target.result.split(`
`),l=t[0].split(";"),o=[];for(let h=1;h<Math.min(6,t.length);h++)if(t[h].trim()){const N=t[h].split(";"),k={};l.forEach((B,D)=>{k[B.trim()]=N[D]?N[D].trim():""}),o.push(k)}f(o)},n.readAsText(a)},O=()=>{var r;if(!i){m({file:"Pilih file CSV terlebih dahulu"});return}c(!0),m({}),console.log("ðŸš€ Mulai import file:",i.name),console.log("ðŸ“ File size:",i.size),console.log("ðŸ“„ File type:",i.type);const a=new FormData;a.append("file",i),console.log("ðŸ“‹ FormData entries:");for(let[s,t]of a.entries())console.log("  -",s,":",t);const n=(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content");console.log("ðŸ” CSRF Token:",n?"Ada":"Tidak ada"),console.log("ðŸŒ Current URL:",window.location.href),console.log("ðŸŽ¯ Target URL:","/questions/import"),fetch("/questions/import",{method:"POST",headers:{Accept:"application/json"},body:a}).then(s=>(console.log("ðŸ“¡ Response status:",s.status),console.log("ðŸ“¡ Response headers:",s.headers),s.redirected?(console.log("ðŸ”„ Response redirected to:",s.url),s.text().then(t=>{if(console.log("ðŸ“„ HTML Response:",t.substring(0,500)),t.includes("success")||t.includes("berhasil"))alert("Import soal berhasil! Halaman akan di-refresh."),p(),d(),g(null),f([]);else{const l=t.match(/error.*?>(.*?)</i);l?alert("Error: "+l[1]):(alert("Import selesai. Silakan refresh halaman untuk melihat hasil."),p(),d())}c(!1)})):s.ok?s.json().then(t=>{console.log("âœ… Import berhasil:",t),alert("Import soal berhasil! Halaman akan di-refresh."),p(),d(),g(null),f([]),c(!1)}):s.text().then(t=>{console.error("âŒ Import error:",t);let l="Terjadi kesalahan saat import";try{const o=JSON.parse(t);o.errors?l+=`:
`+Object.values(o.errors).join(`
`):o.message&&(l+=": "+o.message)}catch{l+=": "+t.substring(0,200)}alert(l),m({file:l}),c(!1)}))).catch(s=>{console.error("âŒ Network error:",s),alert("Gagal mengirim request: "+s.message),m({file:"Network error: "+s.message}),c(!1)})},P=()=>{const a=["No;Mata Pelajaran;Tipe;Soal;Media;Opsi A;Opsi B;Opsi C;Opsi D;Jawaban Benar;Tanggal Dibuat","1;Fisika;Pilihan Ganda;1 + 1 = ...;Tidak ada;2;3;4;;A;","2;Matematika;Pilihan Ganda;Berapakah hasil dari 5 x 5?;Tidak ada;20;25;30;35;B;",'3;Bahasa Indonesia;Pilihan Ganda;Apa arti kata "merdeka"?;Tidak ada;Bebas;Terikat;Terjajah;Tertindas;A;'].join(`
`),n=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),s=URL.createObjectURL(n);r.setAttribute("href",s),r.setAttribute("download","template_import_soal.csv"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)};return S?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Import Soal dari File CSV"}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 p-1",children:e.jsx(R,{className:"h-5 w-5 sm:h-6 sm:w-6"})})]}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsx("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-maroon-50 border border-maroon-200 rounded-lg",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-3 sm:space-y-0",children:[e.jsx(T,{className:"h-5 w-5 text-maroon-500 mr-2 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-maroon-900 text-sm sm:text-base",children:"Download Template CSV"}),e.jsx("p",{className:"text-xs sm:text-sm text-maroon-700 mt-1",children:"Gunakan template ini sebagai panduan format yang benar untuk import soal"})]}),e.jsxs("button",{onClick:P,className:"w-full sm:w-auto inline-flex items-center justify-center px-3 py-2 border border-maroon-300 rounded-md text-xs sm:text-sm font-medium text-maroon-700 bg-white hover:bg-maroon-50",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Download Template"]})]})}),e.jsx("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(E,{className:"h-5 w-5 text-yellow-500 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-900 text-sm sm:text-base",children:"Format yang Diperlukan"}),e.jsxs("ul",{className:"text-xs sm:text-sm text-yellow-700 mt-2 space-y-1",children:[e.jsx("li",{children:"â€¢ File harus berformat CSV dengan delimiter semicolon (;)"}),e.jsx("li",{children:"â€¢ Kolom wajib: No, Mata Pelajaran, Tipe, Soal, Media, Opsi A, Opsi B, Opsi C, Opsi D, Jawaban Benar"}),e.jsx("li",{children:'â€¢ Tipe soal: "Pilihan Ganda" (hanya soal pilihan ganda yang didukung)'}),e.jsx("li",{children:'â€¢ Media: "Ya" atau "Tidak ada"'}),e.jsx("li",{children:"â€¢ Jawaban Benar: A, B, C, atau D (sesuai opsi yang benar)"}),e.jsx("li",{children:"â€¢ Tanggal Dibuat: kosongkan untuk menggunakan tanggal saat ini"})]})]})]})}),e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih File CSV"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-4 sm:p-6 text-center ${C?"border-maroon-500 bg-maroon-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:y,onDragLeave:y,onDragOver:y,onDrop:A,children:[e.jsx(F,{className:"mx-auto h-8 w-8 sm:h-12 sm:w-12 text-gray-400"}),e.jsxs("div",{className:"mt-3 sm:mt-4",children:[e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium text-maroon-600 hover:text-maroon-500",children:"Klik untuk upload"})," ","atau drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"File CSV dengan delimiter semicolon (;)"})]}),e.jsx("input",{type:"file",accept:".csv",name:"csv_file",onChange:a=>v(a.target.files[0]),className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"mt-3 sm:mt-4 inline-flex items-center justify-center px-3 sm:px-4 py-2 border border-transparent text-xs sm:text-sm font-medium rounded-md text-white bg-maroon-600 hover:bg-maroon-700 cursor-pointer",children:"Pilih File"})]}),w.file&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:w.file})]}),i&&e.jsx("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"h-5 w-5 text-green-500 mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-green-900 text-sm sm:text-base",children:["File dipilih: ",i.name]}),e.jsxs("p",{className:"text-xs sm:text-sm text-green-700",children:["Ukuran:"," ",(i.size/1024).toFixed(2)," ","KB"]})]})]})}),b.length>0&&e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Preview Data (5 baris pertama)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:Object.keys(b[0]||{}).map(a=>e.jsx("th",{className:"px-2 sm:px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border border-gray-200",children:a},a))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map((a,n)=>e.jsx("tr",{children:Object.values(a).map((r,s)=>e.jsx("td",{className:"px-2 sm:px-3 py-2 text-xs sm:text-sm text-gray-900 border border-gray-200",children:r||"-"},s))},n))})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3",children:[e.jsx("button",{onClick:d,className:"w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Batal"}),e.jsx("button",{onClick:O,disabled:!i||j,className:"w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-maroon-600 hover:bg-maroon-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Mengimport..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Import Soal"]})})]})]})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-60",children:e.jsx("div",{className:"bg-white rounded-lg p-4 sm:p-6 shadow-xl mx-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-b-2 border-maroon-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900",children:"Mengimport Soal..."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Mohon tunggu sebentar"})]})]})})})]}):null}export{K as default};
